---
title: "Exploratory Analysis of "
author: "Dulshani"
date: "16/06/2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache = TRUE
)

library(arrow) # data retrieval from storage
library(ggrepel) # intelligent label placement
library(gridExtra) # combine multiple plots
library(tidyverse) # dataframe manipulation
library(quanteda)
library(quanteda.textstats)

source('utility_functions.R')
```


```{r read_data}
subreddits = list('GenderCritical', 'MGTOW', 'MGTOW2', 'conservative', 'conspiracy', 'cringeanarchy', 'metacanada')
```

```{r}
combined <- read_reddit_data('changemyview') %>%
  select(-c('link_flair_text', 'upvote_ratio'))

for (subreddit in subreddits) {
  print(subreddit)
  subreddit_df <- read_reddit_data(subreddit) %>%
    select_if(!names(.) %in% c('link_flair_text', 'upvote_ratio'))
  combined <- union(combined, subreddit_df)
}
```

```{r}
# Preprocess data
combined_preprocessed <- pre_process_post_data(combined) %>%
  mutate(post_length = str_count(selftext, '\\s+') + 1)
```

```{r}
head(combined_preprocessed)
```
```{r}
(combined_summary <- combined_preprocessed %>%
  group_by(subreddit) %>%
  summarise(num_posts = n(),
            median_score = median(score),
            median_comments = median(num_comments),
            median_post_length = median(post_length)
            )
)
```

```{r}
# Declare color palette
color_palette <- c("#d73d64",
          "#70be49",
          "#cb72e1",
          "#589646",
          "#5f6bda",
          "#d89b31",
          "#8b4aac",
          "#b2b050",
          "#cf469f",
          "#59c39e",
          "#d35631",
          "#4eacd7",
          "#a1493d",
          "#378562",
          "#cd8bc9",
          "#756f29",
          "#6b7ec4",
          "#c88651",
          "#9d4b76",
          "#e07e88")


# Number of Posts
p0 <- combined_preprocessed %>%
  ggplot( aes(x = subreddit, fill = subreddit)) +
    geom_bar(alpha = 0.6) +
    labs(title = "Number of Posts", x = "", y = "") +
  theme_minimal() +
  theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)
    ) +
   scale_fill_manual(values = color_palette) 
p0
```



```{r}
# Post Length
p1 <- combined_preprocessed %>%
  ggplot( aes(x = subreddit, y = post_length, fill = subreddit)) +
    geom_violin() +
    scale_y_continuous(trans = 'log10') +
    theme_minimal() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)
    ) +
    ggtitle("Post Length") +
    xlab("") +
    ylab("")
```


```{r}
# Number of Comments
p2 <- combined_preprocessed %>%
  ggplot( aes(x = subreddit, y = num_comments, fill = subreddit)) +
    geom_violin() +
    scale_y_continuous(trans = 'log10') +
    theme_minimal() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)
    ) +
    ggtitle("Number of Comments") +
    xlab("") +
    ylab("")
```

```{r}
# Score
p3 <- combined_preprocessed %>%
  ggplot( aes(x = subreddit, y = score, fill = subreddit)) +
    geom_violin() +
    scale_y_continuous(trans = 'log10') +
    theme_minimal() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)
    ) +
    ggtitle("Score") +
    xlab("") +
    ylab("")
```

```{r fig.height = 7}
grid.arrange(p0, p1, p2, p3, nrow = 2)
```

